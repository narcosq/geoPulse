# GeoPulse - –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≥–µ–æ–∑–æ–Ω, push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –∑–≤—É–∫–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤.

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤**: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (Android, iOS, Web)
- **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∑–∏—Ü–∏–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–ì–µ–æ–∑–æ–Ω—ã**: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≥–µ–æ–∑–æ–Ω (–∫—Ä—É–≥, –ø–æ–ª–∏–≥–æ–Ω, –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫)
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: 
  - Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Firebase Cloud Messaging (FCM)
  - Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - –ó–≤—É–∫–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã
- **Event-Driven Architecture**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Kafka –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
- **–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏**: Celery –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Python 3.13**
- **FastAPI** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±—Ä–æ–∫–µ—Ä –¥–ª—è Celery
- **Kafka** - event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **Celery** - —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- **Firebase Admin SDK** - push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **Telegram Bot API** - Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- **Google Maps API** - –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞—Ç–Ω–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **SQLAlchemy 2.0** - ORM
- **Alembic** - –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- Python 3.13
- Poetry (–¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏)

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**

2. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
cp env.example .env
```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`**:
   - PostgreSQL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - Firebase credentials (–ø—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É –∏–ª–∏ JSON —Å—Ç—Ä–æ–∫–∞)
   - Google Maps API –∫–ª—é—á
   - Telegram Bot —Ç–æ–∫–µ–Ω
   - Kafka –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

4. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
```bash
poetry install
```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î**
```bash
make migrate
```

## üê≥ –ó–∞–ø—É—Å–∫ —Å Docker

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make docker_up

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
docker-compose up --build -d
```

–°–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã:
- **API**: http://localhost:8000
- **Jaeger UI**: http://localhost:16686
- **Kafka**: localhost:9092
- **PostgreSQL**: localhost:5432
- **Redis**: localhost:6379

## üì° API Endpoints

### –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `POST /api/v1/devices` - –°–æ–∑–¥–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- `GET /api/v1/devices/{device_id}` - –ü–æ–ª—É—á–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- `GET /api/v1/users/{user_id}/devices` - –ü–æ–ª—É—á–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PATCH /api/v1/devices/{device_id}` - –û–±–Ω–æ–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- `DELETE /api/v1/devices/{device_id}` - –£–¥–∞–ª–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

### –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
- `POST /api/v1/locations` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–µ–æ–∑–æ–Ω—ã)
- `GET /api/v1/devices/{device_id}/locations` - –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∑–∏—Ü–∏–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

### –ì–µ–æ–∑–æ–Ω—ã
- `POST /api/v1/geofences` - –°–æ–∑–¥–∞—Ç—å –≥–µ–æ–∑–æ–Ω—É
- `GET /api/v1/geofences/{geofence_id}` - –ü–æ–ª—É—á–∏—Ç—å –≥–µ–æ–∑–æ–Ω—É
- `GET /api/v1/users/{user_id}/geofences` - –ü–æ–ª—É—á–∏—Ç—å –≥–µ–æ–∑–æ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PATCH /api/v1/geofences/{geofence_id}` - –û–±–Ω–æ–≤–∏—Ç—å –≥–µ–æ–∑–æ–Ω—É
- `DELETE /api/v1/geofences/{geofence_id}` - –£–¥–∞–ª–∏—Ç—å –≥–µ–æ–∑–æ–Ω—É

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `POST /api/v1/notifications` - –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- `GET /api/v1/devices/{device_id}/notifications` - –ü–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

```bash
curl -X POST "http://localhost:8000/api/v1/devices" \
  -H "Content-Type: application/json" \
  -d '{
    "device_id": "device_123",
    "user_id": "user_456",
    "platform": "android",
    "fcm_token": "your_fcm_token_here",
    "name": "My Android Phone"
  }'
```

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏

```bash
curl -X POST "http://localhost:8000/api/v1/locations" \
  -H "Content-Type: application/json" \
  -d '{
    "device_id": "device_123",
    "latitude": 40.7128,
    "longitude": -74.0060,
    "timestamp": "2024-01-01T12:00:00Z"
  }'
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –≥–µ–æ–∑–æ–Ω—ã (–∫—Ä—É–≥)

```bash
curl -X POST "http://localhost:8000/api/v1/geofences" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user_456",
    "name": "Office",
    "geofence_type": "circle",
    "center_latitude": 40.7128,
    "center_longitude": -74.0060,
    "radius_meters": 100,
    "notify_on_enter": true,
    "notify_on_exit": true,
    "enable_push": true,
    "enable_sound": true
  }'
```

## üîÑ Event-Driven Architecture

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Kafka –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π:
- `geopulse.locations` - —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏
- `geopulse.geofences` - —Å–æ–±—ã—Ç–∏—è –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–µ–æ–∑–æ–Ω

## üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### Firebase Push Notifications
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Firebase credentials –≤ `.env`:
```bash
FIREBASE__CREDENTIALS_PATH=/path/to/firebase-credentials.json
```

### Telegram
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Telegram Bot —Ç–æ–∫–µ–Ω:
```bash
TELEGRAM__BOT_TOKEN=your_bot_token
```

## üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:
- **devices** - —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- **locations** - –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏
- **geofences** - –≥–µ–æ–∑–æ–Ω—ã
- **device_geofences** - —Å–≤—è–∑–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ –≥–µ–æ–∑–æ–Ω
- **notifications** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **notification_logs** - –ª–æ–≥–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
make migrate-create message="your migration message"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate

# –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
make migrate-rollback
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å API –ª–æ–∫–∞–ª—å–Ω–æ
make run

# –ó–∞–ø—É—Å—Ç–∏—Ç—å Celery worker
make run_worker

# –ó–∞–ø—É—Å—Ç–∏—Ç—å Celery beat (scheduler)
make run_beat

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
make fmt

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥
make check
```

## üì¶ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Flutter

API —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏. –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```dart
// –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏
final response = await http.post(
  Uri.parse('http://your-api/api/v1/locations'),
  headers: {'Content-Type': 'application/json'},
  body: jsonEncode({
    'device_id': deviceId,
    'latitude': latitude,
    'longitude': longitude,
    'timestamp': DateTime.now().toIso8601String(),
  }),
);
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

- –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ (stdout)
- –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ OpenTelemetry –∏ Jaeger
- Health check endpoints: `/healthz`, `/healthz/live`, `/healthz/ready`

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `.env` —Ñ–∞–π–ª–µ
- `.env` –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–¥–æ–±–∞–≤–ª–µ–Ω –≤ .gitignore)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ production
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –¥–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

[–£–∫–∞–∂–∏—Ç–µ –ª–∏—Ü–µ–Ω–∑–∏—é]

